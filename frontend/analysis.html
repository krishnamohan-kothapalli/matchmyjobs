<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Analyze Resume â€” MatchMyJobs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/shared.css">
<style>
.analysis-page{min-height:calc(100svh - 62px);display:flex;flex-direction:column;padding:2.5rem 1.5rem 4rem}
.analysis-in{max-width:1100px;margin:0 auto;width:100%;flex:1;display:flex;flex-direction:column}
.page-head{margin-bottom:2rem}
.page-head h1{font-family:var(--font-d);font-size:clamp(1.6rem,3.5vw,2.2rem);font-weight:800;color:var(--ink);letter-spacing:-.025em;margin-bottom:.35rem}
.page-head p{font-size:.9rem;color:var(--slate)}
.usage-bar{display:inline-flex;align-items:center;gap:.6rem;background:var(--white);border:1px solid var(--border);border-radius:999px;padding:.35rem 1rem .35rem .5rem;font-size:.78rem;margin-top:.75rem}
.usage-dot{width:8px;height:8px;border-radius:50%;background:var(--green);flex-shrink:0}
.usage-dot.warn{background:var(--amber)}
.usage-dot.danger{background:var(--red)}
.usage-txt{color:var(--slate);font-weight:500}
.usage-count{color:var(--ink);font-weight:700}

.input-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;flex:1;align-items:stretch}
.input-col{display:flex;flex-direction:column;gap:1rem}
.panel{background:var(--white);border:1px solid var(--border);border-radius:var(--rxl);overflow:hidden;box-shadow:var(--sh);transition:box-shadow .2s;display:flex;flex-direction:column;height:100%}
.panel:focus-within{box-shadow:0 0 0 3px rgba(0,200,150,.15),var(--sh)}
.panel-head{display:flex;align-items:center;justify-content:space-between;padding:1.1rem 1.4rem;border-bottom:1px solid var(--border);background:var(--bg);flex-shrink:0}
.panel-title{display:flex;align-items:center;gap:.6rem;font-size:.875rem;font-weight:700;color:var(--ink)}
.panel-title svg{color:var(--green)}
.panel-hint{font-size:.75rem;color:var(--mist)}
#r-upload,#r-paste{flex:1;display:flex;flex-direction:column}

.tabs{display:flex;gap:.25rem;background:var(--border);border-radius:6px;padding:3px}
.tab{padding:.3rem .75rem;border:none;background:none;border-radius:4px;font-family:var(--font-b);font-size:.78rem;font-weight:600;color:var(--slate);cursor:pointer;transition:all .15s}
.tab.active{background:var(--white);color:var(--ink);box-shadow:var(--sh)}

.upload-zone{margin:1.25rem;border:2px dashed var(--border);border-radius:var(--rl);padding:0;text-align:center;cursor:pointer;transition:all .2s;background:var(--bg);flex:1;min-height:340px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.upload-zone:hover,.upload-zone.drag{border-color:var(--green);background:rgba(0,200,150,.04)}
.upload-zone.has-file{border-style:solid;border-color:var(--green);background:rgba(0,200,150,.04)}
.upload-icon{font-size:2rem;margin-bottom:.75rem;display:block}
.upload-main{font-size:.875rem;font-weight:600;color:var(--ink);margin-bottom:.25rem}
.upload-sub{font-size:.78rem;color:var(--mist)}
.upload-file-name{font-size:.8rem;color:var(--green);font-weight:600;margin-top:.5rem;font-family:var(--font-m)}

.or-line{display:flex;align-items:center;gap:.75rem;margin:.25rem 1.25rem;color:var(--mist);font-size:.75rem;font-weight:500;text-transform:uppercase;letter-spacing:.06em}
.or-line::before,.or-line::after{content:'';flex:1;height:1px;background:var(--border)}

textarea{width:100%;resize:none;border:none;outline:none;font-family:var(--font-b);font-size:.875rem;color:var(--ink);line-height:1.7;padding:1.25rem 1.4rem;background:transparent}
textarea::placeholder{color:var(--mist)}
.ta-resume{height:160px}
.ta-jd{flex:1;min-height:340px}
.ta-full{flex:1;min-height:380px}

.char-count{padding:.5rem 1.4rem;font-size:.72rem;color:var(--mist);font-family:var(--font-m);border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.char-count.warn{color:var(--amber)}

.action-row{display:flex;align-items:center;justify-content:space-between;margin-top:1.5rem;flex-wrap:wrap;gap:1rem}
.action-left{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
.btn-sample{background:transparent;border:1.5px solid var(--border);border-radius:var(--r);padding:.55rem 1.1rem;font-family:var(--font-b);font-size:.83rem;font-weight:600;color:var(--slate);cursor:pointer;transition:all .15s}
.btn-sample:hover{border-color:var(--ink3);color:var(--ink)}
.btn-clear{background:transparent;border:none;font-family:var(--font-b);font-size:.83rem;font-weight:500;color:var(--mist);cursor:pointer;transition:color .15s}
.btn-clear:hover{color:var(--red)}
.btn-analyze{background:var(--green);color:#fff;border:none;border-radius:var(--r);padding:.75rem 2rem;font-family:var(--font-b);font-size:1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .18s}
.btn-analyze:hover{background:var(--green-d);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,200,150,.25)}
.btn-analyze:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}

/* LOADING OVERLAY */
.loader{display:none;position:fixed;inset:0;z-index:500;background:rgba(9,17,31,.92);backdrop-filter:blur(8px);flex-direction:column;align-items:center;justify-content:center;gap:1.5rem}
.loader.show{display:flex}
.loader-ring{width:64px;height:64px;border:4px solid rgba(255,255,255,.1);border-top:4px solid var(--green);border-radius:50%;animation:spin .8s linear infinite}
.loader-txt{font-family:var(--font-d);font-size:1.1rem;font-weight:800;color:#fff}
.loader-sub{font-size:.85rem;color:rgba(255,255,255,.45);margin-top:-.75rem}
.loader-bar{width:280px;height:4px;background:rgba(255,255,255,.1);border-radius:999px;overflow:hidden}
.loader-fill{height:100%;background:var(--green);border-radius:999px;width:0%;transition:width .4s ease}
.loader-steps{display:flex;flex-direction:column;gap:.5rem;margin-top:.5rem}
.lstep{display:flex;align-items:center;gap:.6rem;font-size:.82rem;color:rgba(255,255,255,.3);transition:color .3s}
.lstep.done{color:rgba(255,255,255,.7)}
.lstep.active{color:#fff}
.lstep-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.2);flex-shrink:0;transition:background .3s}
.lstep.done .lstep-dot{background:var(--green)}
.lstep.active .lstep-dot{background:#fff;animation:pulse 1s ease infinite}

/* ERROR TOAST */
.toast{position:fixed;top:80px;left:50%;transform:translateX(-50%) translateY(-20px);background:#fff;border:1px solid var(--border);border-left:4px solid var(--red);border-radius:var(--r);padding:.9rem 1.25rem;font-size:.875rem;color:var(--ink);box-shadow:var(--shl);z-index:400;opacity:0;transition:all .25s;pointer-events:none;max-width:500px;width:90%}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

@media(max-width:860px){
  .input-grid{grid-template-columns:1fr}
  .ta-full{height:280px}
  .ta-jd{height:280px}
  .ta-resume{height:140px}
}
@media(max-width:500px){
  .analysis-page{padding:1.5rem 1rem 3rem}
  .action-row{flex-direction:column;align-items:stretch}
  .btn-analyze{justify-content:center}
}
</style>
</head>
<body>
<nav class="nav">
  <div class="nav-in">
    <a href="index.html" class="logo"><span class="logo-a">Match</span><span class="logo-b">MyJobs</span></a>
    <div class="nav-r" id="nav-r"></div>
  </div>
</nav>

<div class="analysis-page">
  <div class="analysis-in">
    <div class="page-head reveal">
      <h1>Analyze Your Resume</h1>
      <p>Upload or paste your resume and job description â€” we'll score your ATS compatibility in under 30 seconds.</p>
      <div class="usage-bar">
        <div class="usage-dot" id="usage-dot"></div>
        <span class="usage-txt">Analyses used this month:</span>
        <span class="usage-count" id="usage-count">Loadingâ€¦</span>
      </div>
    </div>

    <div class="input-grid">
      <!-- LEFT: Resume -->
      <div class="input-col reveal d1">
        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
              Resume
            </div>
            <div class="tabs">
              <button class="tab active" onclick="setTab('r','upload',this)">Upload</button>
              <button class="tab" onclick="setTab('r','paste',this)">Paste</button>
            </div>
          </div>
          <div id="r-upload">
            <div class="upload-zone" id="drop-zone" onclick="document.getElementById('resume-file').click()" ondragover="drag(event,true)" ondragleave="drag(event,false)" ondrop="drop(event)">
              <input type="file" id="resume-file" accept=".pdf,.doc,.docx" hidden onchange="fileChosen(this)">
              <span class="upload-icon">ðŸ“„</span>
              <div class="upload-main">Click to upload or drag & drop</div>
              <div class="upload-sub">PDF or DOCX Â· Max 10MB</div>
              <div class="upload-file-name" id="file-name"></div>
            </div>
          </div>
          <div id="r-paste" style="display:none">
            <textarea class="ta-resume" id="resume-paste" placeholder="Paste your resume text hereâ€¦" oninput="countChars(this,'rc')"></textarea>
            <div class="char-count"><span id="rc">0 characters</span></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Job Description -->
      <div class="input-col reveal d2">
        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
              Job Description
            </div>
            <span class="panel-hint">Paste from job posting</span>
          </div>
          <textarea class="ta-full" id="jd-paste" placeholder="Paste the full job description hereâ€¦&#10;&#10;The more complete it is, the more accurate your score." oninput="countChars(this,'jc')"></textarea>
          <div class="char-count"><span id="jc">0 characters</span><span id="jc-warn" style="display:none;color:var(--amber)">Try to paste the complete description</span></div>
        </div>
      </div>
    </div>

    <div class="action-row">
      <div class="action-left">
        <button class="btn-sample" onclick="loadSample()">Load Sample Data</button>
        <button class="btn-clear" onclick="clearAll()">Clear All</button>
      </div>
      <button class="btn-analyze" id="analyze-btn" onclick="startAnalysis()">
        Analyze Resume
        <svg width="18" height="18" fill="none" viewBox="0 0 20 20"><path d="M4 10h12m0 0l-4-4m4 4l-4 4" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- LOADER -->
<div class="loader" id="loader">
  <div class="loader-ring"></div>
  <div class="loader-txt">Analyzingâ€¦</div>
  <div class="loader-sub" id="loader-sub">Reading your resume</div>
  <div class="loader-bar"><div class="loader-fill" id="loader-fill"></div></div>
  <div class="loader-steps">
    <div class="lstep" id="ls1"><div class="lstep-dot"></div><span>Parsing documents</span></div>
    <div class="lstep" id="ls2"><div class="lstep-dot"></div><span>Extracting skills & requirements</span></div>
    <div class="lstep" id="ls3"><div class="lstep-dot"></div><span>Running ATS scoring engine</span></div>
    <div class="lstep" id="ls4"><div class="lstep-dot"></div><span>Generating your report</span></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
const API = window.location.hostname === 'localhost' ? 'http://127.0.0.1:8000' : 'https://matchmyjobs.onrender.com';

// Auth guard
const email = localStorage.getItem('userEmail');
if (!localStorage.getItem('authToken')) { window.location.href = 'auth.html'; }

// Nav
(function(){
  const r = document.getElementById('nav-r');
  r.innerHTML = `<a href="dashboard.html" class="btn-ng">Dashboard</a><button onclick="signOut()" class="btn-ng">Sign Out</button>`;
})();
function signOut(){ localStorage.clear(); window.location.href='auth.html'; }

// Usage display
(function(){
  const u = JSON.parse(localStorage.getItem('usageData')||'{}');
  const used = u.analysesUsed||0, limit = u.analysesLimit||2;
  const dot = document.getElementById('usage-dot'), cnt = document.getElementById('usage-count');
  cnt.textContent = `${used} / ${limit}`;
  if(used>=limit){ dot.className='usage-dot danger'; }
  else if(used>=limit-1){ dot.className='usage-dot warn'; }
})();

// Tabs
function setTab(panel, mode, btn){
  document.querySelectorAll(`[id^="${panel}-"]`).forEach(el=>el.style.display='none');
  document.getElementById(`${panel}-${mode}`).style.display='';
  btn.closest('.tabs').querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');
}

// File upload
function fileChosen(input){
  const file = input.files[0]; if(!file) return;
  if(file.size > 10*1024*1024){ toast('File too large. Max 10MB.'); return; }
  const ext = file.name.split('.').pop().toLowerCase();
  if(!['pdf','doc','docx'].includes(ext)){ toast('Please upload a PDF or DOCX file.'); return; }
  window._resumeFile = file;
  document.getElementById('file-name').textContent = 'âœ“ ' + file.name;
  document.getElementById('drop-zone').classList.add('has-file');
}
function drag(e, on){ e.preventDefault(); document.getElementById('drop-zone').classList.toggle('drag',on); }
function drop(e){
  e.preventDefault();
  drag(e, false);
  const file = e.dataTransfer.files[0];
  if(file){ const dt = new DataTransfer(); dt.items.add(file); const inp = document.getElementById('resume-file'); inp.files = dt.files; fileChosen(inp); }
}

// Char count
function countChars(ta, id){
  const n = ta.value.length;
  document.getElementById(id).textContent = n.toLocaleString() + ' characters';
  if(id==='jc'){ document.getElementById('jc-warn').style.display = n>0&&n<300?'inline':'none'; }
  document.getElementById('jc').className = n>45000?'warn':'';
}

// Toast
function toast(msg, dur=4000){
  const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show');
  clearTimeout(t._t); t._t = setTimeout(()=>t.classList.remove('show'), dur);
}

// Sample data
function loadSample(){
  const resume = `Sarah Johnson | sarah.johnson@email.com | (555) 987-6543 | linkedin.com/in/sarahjohnson

SUMMARY
Senior UX Designer with 6 years of experience designing intuitive digital products for SaaS companies. Expert in Figma, user research, and design systems. Led redesigns that improved conversion by 34%.

EXPERIENCE
Senior UX Designer â€” TechCorp Inc. (2021â€“Present)
â€¢ Led end-to-end redesign of core product, increasing user retention by 28%
â€¢ Built and maintained design system used by 12-person engineering team
â€¢ Conducted 40+ user interviews and usability tests annually
â€¢ Collaborated with product managers to define roadmap priorities

UX Designer â€” StartupXYZ (2019â€“2021)
â€¢ Designed mobile-first interfaces for iOS and Android apps (500K+ users)
â€¢ Created wireframes, prototypes, and high-fidelity mockups in Figma
â€¢ Ran A/B tests that improved onboarding completion by 22%

SKILLS
Figma, Adobe XD, Sketch, InVision, UserTesting, Hotjar, HTML/CSS, Design Systems, Wireframing, Prototyping, User Research, Usability Testing, WCAG 2.1, Responsive Design, Agile/Scrum

EDUCATION
B.S. Interaction Design â€” University of California, San Diego (2019)`;

  const jd = `Senior UX Designer â€” CloudSaaS Inc.

We're looking for a Senior UX Designer to lead design for our B2B SaaS platform.

Requirements:
â€¢ 5+ years UX/UI design experience
â€¢ Expert in Figma and modern design tools
â€¢ Strong portfolio showing user research and high-fidelity design
â€¢ Experience creating and maintaining design systems
â€¢ Excellent presentation skills
â€¢ Responsive design and mobile-first experience
â€¢ Proficiency in user research methodologies and usability testing
â€¢ Knowledge of WCAG 2.1 accessibility standards

Preferred:
â€¢ SaaS product design experience
â€¢ A/B testing and data-driven design
â€¢ Experience with design thinking workshops`;

  setTab('r', 'paste', document.querySelectorAll('[id="r-paste"]')[0]?.previousElementSibling?.querySelector('.tab:last-child') || document.querySelector('#r-paste')?.previousElementSibling?.querySelector('.tab:last-child'));
  document.getElementById('r-paste').style.display='';
  document.getElementById('r-upload').style.display='none';
  document.querySelectorAll('.tabs .tab').forEach((t,i)=>{t.classList.toggle('active',i===1)});

  document.getElementById('resume-paste').value = resume;
  document.getElementById('jd-paste').value = jd;
  countChars(document.getElementById('resume-paste'),'rc');
  countChars(document.getElementById('jd-paste'),'jc');
  toast('Sample data loaded! Click Analyze to see results.', 3000);
}

function clearAll(){
  document.getElementById('resume-paste').value='';
  document.getElementById('jd-paste').value='';
  document.getElementById('file-name').textContent='';
  document.getElementById('drop-zone').classList.remove('has-file');
  document.getElementById('resume-file').value='';
  window._resumeFile=null;
  countChars(document.getElementById('resume-paste'),'rc');
  countChars(document.getElementById('jd-paste'),'jc');
}

// Loading steps
function setStep(n){
  for(let i=1;i<=4;i++){
    const el=document.getElementById('ls'+i);
    if(i<n) el.className='lstep done';
    else if(i===n) el.className='lstep active';
    else el.className='lstep';
  }
}
function setProgress(pct, sub){
  document.getElementById('loader-fill').style.width=pct+'%';
  if(sub) document.getElementById('loader-sub').textContent=sub;
}

// Analysis
async function startAnalysis(){
  const btn = document.getElementById('analyze-btn');
  const isUpload = document.getElementById('r-upload').style.display!=='none';
  let resumeText = '';

  if(isUpload && window._resumeFile){
    try{
      setProgress(10,'Parsing resume fileâ€¦');
      document.getElementById('loader').classList.add('show');
      setStep(1);
      resumeText = await parseFile(window._resumeFile);
    }catch(e){ document.getElementById('loader').classList.remove('show'); toast('Could not read file. Try pasting the text instead.'); return; }
  } else {
    resumeText = document.getElementById('resume-paste').value.trim();
  }

  const jdText = document.getElementById('jd-paste').value.trim();

  if(!resumeText){ toast('Please upload a resume or paste your resume text.'); return; }
  if(!jdText){ toast('Please paste the job description.'); return; }
  if(resumeText.length < 100){ toast('Resume is too short. Please paste the full text.'); return; }
  if(jdText.length < 50){ toast('Job description is too short. Please paste more content.'); return; }

  // Check usage limit
  const u = JSON.parse(localStorage.getItem('usageData')||'{}');
  const used = u.analysesUsed||0, limit = u.analysesLimit||2, tier = u.userTier||'free';
  if(tier==='free' && used>=limit){
    toast('You\'ve used all ' + limit + ' free analyses this month. Upgrade to continue.', 6000);
    setTimeout(()=>window.location.href='dashboard.html', 2000);
    return;
  }

  btn.disabled = true;
  document.getElementById('loader').classList.add('show');
  setStep(1); setProgress(15,'Parsing documentsâ€¦');
  await sleep(400);
  setStep(2); setProgress(40,'Extracting skills & requirementsâ€¦');

  try{
    const res = await fetch(`${API}/score`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({resume_text:resumeText, jd_text:jdText, email:email||null})
    });

    setStep(3); setProgress(75,'Running ATS scoring engineâ€¦');
    await sleep(300);

    if(!res.ok){
      const err = await res.json().catch(()=>({}));
      if(res.status===403){ document.getElementById('loader').classList.remove('show'); toast(err.detail||'Monthly limit reached. Visit your dashboard to upgrade.', 6000); btn.disabled=false; return; }
      throw new Error(err.detail||'Server error');
    }

    const data = await res.json();
    setStep(4); setProgress(100,'Building your reportâ€¦');

    // Sync usage
    if(data.usage){
      const ud = JSON.parse(localStorage.getItem('usageData')||'{}');
      ud.analysesUsed=data.usage.analyses_used; ud.analysesLimit=data.usage.analyses_limit; ud.remaining=data.usage.remaining;
      localStorage.setItem('usageData',JSON.stringify(ud));
    } else {
      const ud = JSON.parse(localStorage.getItem('usageData')||'{}');
      ud.analysesUsed=(ud.analysesUsed||0)+1;
      localStorage.setItem('usageData',JSON.stringify(ud));
    }

    localStorage.setItem('auditResults',JSON.stringify(data));
    await sleep(600);
    window.location.href='audit.html';

  }catch(e){
    document.getElementById('loader').classList.remove('show');
    toast(e.message||'Analysis failed. Please try again.');
    btn.disabled=false;
  }
}

async function parseFile(file){
  const ext = file.name.split('.').pop().toLowerCase();

  // â”€â”€ PDF: use PDF.js for proper text extraction â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(ext === 'pdf'){
    // Lazy-load PDF.js from CDN
    if(!window.pdfjsLib){
      await new Promise((res,rej)=>{
        const s=document.createElement('script');
        s.src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
        s.onload=res; s.onerror=()=>rej(new Error('Failed to load PDF.js'));
        document.head.appendChild(s);
      });
      pdfjsLib.GlobalWorkerOptions.workerSrc=
        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
    let fullText = '';
    for(let i=1; i<=pdf.numPages; i++){
      const page = await pdf.getPage(i);
      const content = await page.getTextContent();
      const pageText = content.items.map(item=>item.str).join(' ');
      fullText += pageText + '\n';
    }
    if(!fullText || fullText.trim().length < 50)
      throw new Error('Could not extract text from PDF. Try copy-pasting the text instead.');
    return fullText;
  }

  // â”€â”€ DOCX: use mammoth.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(ext === 'docx' || ext === 'doc'){
    if(!window.mammoth){
      await new Promise((res,rej)=>{
        const s=document.createElement('script');
        s.src='https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js';
        s.onload=res; s.onerror=()=>rej(new Error('Failed to load mammoth.js'));
        document.head.appendChild(s);
      });
    }
    const arrayBuffer = await file.arrayBuffer();
    const result = await mammoth.extractRawText({arrayBuffer});
    if(!result.value || result.value.trim().length < 50)
      throw new Error('Could not extract text from DOCX. Try copy-pasting the text instead.');
    return result.value;
  }

  // â”€â”€ Plain text fallback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return new Promise((resolve,reject)=>{
    const reader=new FileReader();
    reader.onload=e=>{
      const text=e.target.result;
      if(!text||text.trim().length<50) reject(new Error('Could not extract text from file.'));
      else resolve(text);
    };
    reader.onerror=()=>reject(new Error('File read failed'));
    reader.readAsText(file);
  });
}

function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

// Scroll reveal
const io=new IntersectionObserver(e=>e.forEach(en=>{if(en.isIntersecting){en.target.classList.add('in');io.unobserve(en.target);}}),{threshold:.1});
document.querySelectorAll('.reveal').forEach(el=>io.observe(el));
</script>
</body>
</html>
